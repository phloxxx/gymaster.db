USE GYMASTER 
GO

CREATE PROCEDURE SP_INSERTPROGRAM
(
    @PROGRAM_NAME VARCHAR(50)
)
AS
BEGIN
    IF EXISTS (SELECT 1 FROM PROGRAM WHERE PROGRAM_NAME = @PROGRAM_NAME)
    BEGIN
        RAISERROR('Program name already exists.', 16, 1);
        RETURN;
    END

    INSERT INTO PROGRAM (PROGRAM_NAME)
    VALUES (@PROGRAM_NAME);

    SELECT SCOPE_IDENTITY() AS NEWPROGRAMID;
END
GO

CREATE PROCEDURE SP_UPDATEPROGRAM
(
    @PROGRAM_ID SMALLINT,
    @PROGRAM_NAME VARCHAR(50)
)
AS
BEGIN
    IF NOT EXISTS (SELECT 1 FROM PROGRAM WHERE PROGRAM_ID = @PROGRAM_ID)
    BEGIN
        RAISERROR('Program not found.', 16, 1);
        RETURN;
    END

    IF EXISTS (SELECT 1 FROM PROGRAM WHERE PROGRAM_NAME = @PROGRAM_NAME AND PROGRAM_ID != @PROGRAM_ID)
    BEGIN
        RAISERROR('Program name already exists.', 16, 1);
        RETURN;
    END

    UPDATE PROGRAM
    SET PROGRAM_NAME = @PROGRAM_NAME
    WHERE PROGRAM_ID = @PROGRAM_ID;

    SELECT @@ROWCOUNT AS RowsAffected;
END
GO

