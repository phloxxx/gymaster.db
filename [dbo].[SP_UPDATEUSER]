USE [GYMASTER]
GO
/****** Object:  StoredProcedure [dbo].[SP_UPDATEUSER]    Script Date: 09/12/2024 12:51:04 am ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[SP_UPDATEUSER]
    @USER_ID SMALLINT,
    @USER_FNAME VARCHAR(50) = NULL,
    @USER_LNAME VARCHAR(30) = NULL,
    @USERNAME VARCHAR(20) = NULL,
    @USER_TYPE VARCHAR(10) = NULL,
    @IS_ACTIVE BIT = NULL
AS
BEGIN
    IF @USERNAME IS NOT NULL AND 
       EXISTS (SELECT 1 FROM [USER] WHERE USERNAME = @USERNAME AND USER_ID != @USER_ID)
    BEGIN
        RAISERROR('Username already exists. Please choose a different username.', 16, 1);
        RETURN;
    END
    
    UPDATE [USER]
    SET USER_FNAME = COALESCE(@USER_FNAME, USER_FNAME),
        USER_LNAME = COALESCE(@USER_LNAME, USER_LNAME),
        USERNAME = COALESCE(@USERNAME, USERNAME),
        USER_TYPE = COALESCE(UPPER(@USER_TYPE), USER_TYPE),
        IS_ACTIVE = COALESCE(@IS_ACTIVE, IS_ACTIVE)
    WHERE USER_ID = @USER_ID
END
