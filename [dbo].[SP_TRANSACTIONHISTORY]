USE [GYMASTER]
GO
/****** Object:  StoredProcedure [dbo].[SP_TRANSACTIONHISTORY]    Script Date: 09/12/2024 12:48:56 am ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [dbo].[SP_TRANSACTIONHISTORY]
    @MEMBER_ID SMALLINT = NULL
AS
BEGIN
    SELECT 
        T.TRANSACTION_ID,
        T.MEMBER_ID,
        M.MEMBER_FULLNAME,
        T.SUB_ID,
        S.SUB_NAME,
        P.PAY_METHOD,
        T.TRANSAC_DATE
    FROM 
        [TRANSACTION] T
    JOIN 
        MEMBER M ON T.MEMBER_ID = M.MEMBER_ID
    JOIN 
        SUBSCRIPTION S ON T.SUB_ID = S.SUB_ID
    JOIN 
        PAYMENT P ON T.PAYMENT_ID = P.PAYMENT_ID
    WHERE 
        (@MEMBER_ID IS NULL OR T.MEMBER_ID = @MEMBER_ID)
    ORDER BY 
        T.TRANSAC_DATE DESC
END
