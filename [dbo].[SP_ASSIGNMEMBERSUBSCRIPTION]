USE [GYMASTER]
GO
/****** Object:  StoredProcedure [dbo].[SP_ASSIGNMEMBERSUBSCRIPTION]    Script Date: 09/12/2024 12:44:06 am ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[SP_ASSIGNMEMBERSUBSCRIPTION]
    @MEMBER_ID SMALLINT,
    @SUB_ID SMALLINT
AS
BEGIN
    DECLARE @DURATION VARCHAR(10)
    SELECT @DURATION = DURATION FROM SUBSCRIPTION WHERE SUB_ID = @SUB_ID

    DECLARE @END_DATE DATE
    SET @END_DATE = 
        CASE @DURATION
            WHEN 'Monthly' THEN DATEADD(MONTH, 1, GETDATE())
            WHEN 'Quarterly' THEN DATEADD(MONTH, 3, GETDATE())
            WHEN 'Semestral' THEN DATEADD(MONTH, 6, GETDATE())
            WHEN 'Annually' THEN DATEADD(YEAR, 1, GETDATE())
            ELSE NULL
        END

    INSERT INTO MEMBER_SUBSCRIPTION (MEMBER_ID, SUB_ID, END_DATE)
    VALUES (@MEMBER_ID, @SUB_ID, @END_DATE)
END
