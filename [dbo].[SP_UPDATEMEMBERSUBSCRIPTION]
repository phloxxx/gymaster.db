USE [GYMASTER]
GO
/****** Object:  StoredProcedure [dbo].[SP_UPDATEMEMBERSUBSCRIPTION]    Script Date: 09/12/2024 12:49:50 am ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[SP_UPDATEMEMBERSUBSCRIPTION]
    @MEMBER_ID SMALLINT,
    @SUB_ID SMALLINT,
    @IS_ACTIVE BIT = NULL
AS
BEGIN
    DECLARE @DURATION VARCHAR(10)
    SELECT @DURATION = DURATION FROM SUBSCRIPTION WHERE SUB_ID = @SUB_ID

    DECLARE @END_DATE DATE
    SET @END_DATE = 
        CASE @DURATION
            WHEN 'Monthly' THEN DATEADD(MONTH, 1, GETDATE())
            WHEN 'Quarterly' THEN DATEADD(MONTH, 3, GETDATE())
            WHEN 'Semestral' THEN DATEADD(MONTH, 6, GETDATE())
            WHEN 'Annually' THEN DATEADD(YEAR, 1, GETDATE())
            ELSE NULL
        END

    UPDATE MEMBER_SUBSCRIPTION
    SET START_DATE = GETDATE(),
        END_DATE = @END_DATE,
        IS_ACTIVE = COALESCE(@IS_ACTIVE, IS_ACTIVE)
    WHERE MEMBER_ID = @MEMBER_ID AND SUB_ID = @SUB_ID

END
